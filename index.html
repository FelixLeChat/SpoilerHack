<head>
	<link rel="stylesheet" type="text/css" href="style.css">
	<script type="text/javascript" src="script/jquery.js"></script>
	<script>
		window.onload = function() {

			// Get references to elements on the page.
			var form = document.getElementById('message-form');
			var messageField = document.getElementById('message');
			var socketStatus = document.getElementById('status');
			var hashtaglist = document.getElementById('hashtagList');
			var hashlist = [];

			// Create a new WebSocket.
			var socket = new WebSocket('ws://websocket-spoileralert.herokuapp.com');


			// Handle any errors that occur.
			socket.onerror = function(error) {
				console.log('WebSocket Error: ' + error);
			};
			// Show a connected message when the WebSocket is opened.
			socket.onopen = function(event) {
				socketStatus.innerHTML = 'Connected to server.';
				socketStatus.className = 'open';
			};
			// Handle messages sent by the server.
			socket.onmessage = function(event) {
				var data = JSON.parse(event.data);
				if(data != undefined){
					//for (var i = data.length - 1; i >= 0; i--) {
						$('#row').html('<li>'+data+'</li>' + $('#row').html());
					//};
				};
					

			};
			// Show a disconnected message when the WebSocket is closed.
			socket.onclose = function(event) {
				socketStatus.innerHTML = 'Disconnected from server.';
				socketStatus.className = 'closed';
			};


			// Send a message when the form is submitted.
			form.onsubmit = function(e) {
				e.preventDefault();

				// get selected hash
				var message = messageField.value;
				messageField.value = "";
				message = message.toLowerCase();

				if(hashlist.indexOf(message) >= 0)
				{
					return;
				}
					
				hashlist.push(message);

				// Add button for each tag
				$("#hashtagList").append("<button class=\"btn btn-primary\" type=\"button\">" + message + "<span class=\"badge\" class=\"badgeclick\">   X</span></button>");

				// Remove button on click
				$( ".btn" ).click(function() {
					var html = $( this ).html();
					var matches = html.match(/([^<]+)/g);

					if(matches != null && hashlist.indexOf(matches[0]) >= 0)
					{
						var index = hashlist.indexOf(matches[0])
						if (index > -1) {
						    hashlist.splice(index, 1);
						}
					}

					$( this ).remove();
				});
				return false;
			};

			// get new tweets each 5 sec
			setInterval(function()
			{
				// send hashtag to get notif from
				var message = JSON.stringify({ids: hashlist});
				socket.send(message);
			}, 1000);
		};
	</script>
</head>

<div id="page-wrapper">
	<h1>Twitter Spoiler Alert</h1>

	<div id="status">Connecting...</div>

	<form id="message-form" action="#" method="post">
		<input type="text" id="message" placeholder="Write the # to watch" required>
		<button type="submit">Add #</button>
	</form>

	<div id="hashtagList"></div>
</div>
<div id="page-wrapper">
	<h2>Previous :</h2>
	<ul id="row"></ul>
</div>